import{_ as c,T as r,U as _,r as f,c as p,d as t,i as m,v as u,w as g,j as h,k as T,l as k,m as w,o as d,p as S,F as C,h as v,t as L}from"./index-Bvz4Dz3v.js";const b={name:"TemplateLink",data(){return{name:"TemplateLink",template_path:"",select_col:null,template_list:[],selected_template:null,dir_path:""}},methods:{initAllTLScriptList(){let s=window.scriptMap,e=[];for(let o in s)e.push(o);this.template_list=e},initViewByData(){r.workBookScriptImport();let s=window.Application.ThisWorkbook.FullName;this.dir_path=_.getActiveSheetPath();let n=(r.GetTemplateLinkJson()[this.name]||{})[this.dir_path]||{};this.template_path=n.tpath||"",this.initSelectCol(),this.initAllTLScriptList();let l=n[s]&&n[s][this.select_col];l&&this.template_list.indexOf(l)>-1?this.selected_template=l:this.selected_template=null},initSelectCol(){this.select_col=window.Application.Selection.Columns.Count==1?window.Application.Selection.Column:0},onTemplateChange(s){let e=window.Application.ThisWorkbook.FullName,o=r.GetTemplateLinkJson(),n=o[this.name]||{},l=n[this.dir_path]||{},a=l[e]||{};const i=s.target.value;i===null?delete a[this.select_col]:a[this.select_col]=i,l[e]=a,n[this.dir_path]=l,o[this.name]=n,r.SetTemplateLinkJson(o)},handleFileChange(s){const e=s.target.value.replace(/\\/g,"/");let o=r.GetTemplateLinkJson(),n=o[this.name]||{},l=n[this.dir_path]||{};l.tpath=e,n[this.dir_path]=l,o[this.name]=n,r.SetTemplateLinkJson(o),this.onRefreshTemplate()},onSelectTempplatePath(){let s=window.wps.FileDialog(4);s.AllowMultiSelect=!1,s.Show()&&(this.template_path=s.SelectedItems.Item(1).replace(/\\/g,"/"),this.handleFileChange({target:{value:this.template_path}}))},onRefreshTemplate(){console.log("刷新模板列表..."),f.TLRefreshScriptImport(),this.initAllTLScriptList()},onSelectionChange(){}},mounted(){this.initViewByData()},beforeUnmount(){}},y={class:"template-container"},F={class:"styled-table"},x={key:0},A={key:1},D={key:0},V={key:0},B=["value"],N={key:1};function U(s,e,o,n,l,a){return d(),p("div",y,[t("table",F,[t("tbody",null,[t("tr",null,[e[8]||(e[8]=t("td",null,"自定义模板路径:",-1)),t("td",null,[m(t("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>l.template_path=i),required:"",onBlur:e[1]||(e[1]=(...i)=>a.handleFileChange&&a.handleFileChange(...i)),onKeyup:e[2]||(e[2]=g((...i)=>a.handleFileChange&&a.handleFileChange(...i),["enter"])),class:"input-field"},null,544),[[u,l.template_path]])]),t("td",null,[t("button",{class:"btn-select-path",onClick:e[3]||(e[3]=(...i)=>a.onSelectTempplatePath&&a.onSelectTempplatePath(...i))}," 选择路径 ")])]),e[15]||(e[15]=t("tr",{style:{"border-bottom":"1px solid #ddd"}},[t("td",{colspan:"2"})],-1)),e[16]||(e[16]=t("tr",null,[t("td",{colspan:"2"},[t("span",{class:"span-title"},"设置模板")])],-1)),t("tr",null,[e[9]||(e[9]=t("td",null,"当前excel路径:",-1)),t("td",null,[m(t("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>l.dir_path=i),disabled:"true",class:"input-field"},null,512),[[u,l.dir_path]])])]),t("tr",null,[e[10]||(e[10]=t("td",null,"选中列:",-1)),l.select_col?(d(),p("td",x,[m(t("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>l.select_col=i),disabled:"true",class:"input-field"},null,512),[[u,l.select_col]])])):h("",!0),l.select_col?h("",!0):(d(),p("td",A,"只能选中一列或者一格"))]),T(w,{name:"fade"},{default:k(()=>[l.select_col?(d(),p("tr",D,[e[14]||(e[14]=t("td",null,"模板列表:",-1)),t("td",null,[l.template_list.length>0?(d(),p("div",V,[m(t("select",{"onUpdate:modelValue":e[6]||(e[6]=i=>l.selected_template=i),onChange:e[7]||(e[7]=(...i)=>a.onTemplateChange&&a.onTemplateChange(...i)),class:"select-field"},[e[11]||(e[11]=t("option",{value:null,disabled:"",selected:""},"请选择模板",-1)),e[12]||(e[12]=t("option",{value:null},"无",-1)),(d(!0),p(C,null,v(l.template_list,i=>(d(),p("option",{value:i,key:i},L(i),9,B))),128))],544),[[S,l.selected_template]])])):(d(),p("div",N,e[13]||(e[13]=[t("p",{class:"no-template-message"},"该路径下没找到可用模板 ¿",-1)])))])])):h("",!0)]),_:1})])])])}const J=c(b,[["render",U],["__scopeId","data-v-299aa49a"]]);export{J as default};
